<!--
    Copyright ©  2020  Andrej Melekhin <QWERTYkez@outlook.com>.

    This file is part of FlexTrader
    FlexTrader is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    FlexTrader is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with FlexTrader. If not, see <http://www.gnu.org/licenses/>.
!-->

<UserControl
    x:Class="FlexTrader.MVVM.Views.ChartView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:CM="clr-namespace:ChartModules;assembly=ChartModules"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:FlexTrader.MVVM.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:res="clr-namespace:FlexTrader.MVVM.Resources"
    xmlns:vm="clr-namespace:FlexTrader.MVVM.ViewModels"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <UserControl.DataContext>
        <vm:ChartViewModel />
    </UserControl.DataContext>
    <Grid
        Background="{Binding ChartBackground}"
        ClipToBounds="True"
        PreviewMouseWheel="MouseWheelSpinning">
        <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition x:Name="PriceLineCD" Width="70" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="4*" />
            <RowDefinition x:Name="IndicatorsSplitterRD" Height="Auto" />
            <RowDefinition x:Name="IndicatorsRowRD" Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition x:Name="TimeLineRD" Height="50" />
        </Grid.RowDefinitions>
        <Grid Grid.RowSpan="4" ClipToBounds="True">
            <CM:DrawingCanvas x:Name="GridLayerVertical" />
        </Grid>
        <Grid
            x:Name="ChartGRD"
            Background="{StaticResource CursorGrabber}"
            ClipToBounds="True"
            Cursor="None"
            SizeChanged="ChartGrid_SizeChanged">
            <CM:DrawingCanvas x:Name="GridLayerHorizontal" />
            <CM:DrawingCanvas x:Name="BackgroundIndLayer" />
            <Grid ClipToBounds="True">
                <Grid RenderTransformOrigin="1,0.5">
                    <Grid RenderTransformOrigin="0.5,0.5">
                        <ItemsControl x:Name="LowerLayers" />
                        <CM:DrawingCanvas x:Name="CandlesLayer" />
                        <ItemsControl x:Name="TopLayers" />
                        <Grid.RenderTransform>
                            <TransformGroup>
                                <RotateTransform Angle="180" />
                                <TranslateTransform x:Name="Translate" />
                                <ScaleTransform x:Name="ScaleY" />
                            </TransformGroup>
                        </Grid.RenderTransform>
                    </Grid>
                    <Grid.RenderTransform>
                        <ScaleTransform x:Name="ScaleX" />
                    </Grid.RenderTransform>
                </Grid>
            </Grid>
            <CM:DrawingCanvas x:Name="ForegroundIndLayer" />
            <Grid x:Name="SubLayers">
                <CM:DrawingCanvas x:Name="LevelsLayer" />
                <CM:DrawingCanvas x:Name="PaintingsLayer" />
            </Grid>
            <CM:DrawingCanvas x:Name="HooksLayer" />
            <Grid>
                <CM:DrawingCanvas x:Name="PrototypeLayer" />
                <CM:DrawingCanvas x:Name="CursorLayer" />
                <CM:DrawingCanvas x:Name="MagnetLayer" />
            </Grid>
        </Grid>
        <Grid
            x:Name="PriceLine"
            Grid.Column="2"
            Background="{StaticResource CursorGrabber}"
            ClipToBounds="True">
            <CM:DrawingCanvas x:Name="PricesLayer" />
            <CM:DrawingCanvas x:Name="PaintingMarksLayer" />
            <CM:DrawingCanvas x:Name="HookPriceLayer" />
            <CM:DrawingCanvas x:Name="CursorPriceMarkLayer" />
            <CM:DrawingCanvas x:Name="PrototypePriceLayer" />
        </Grid>
        <Grid
            x:Name="TimeLine"
            Grid.Row="4"
            Background="{StaticResource CursorGrabber}"
            ClipToBounds="True">
            <CM:DrawingCanvas x:Name="TimesLayer" />
            <CM:DrawingCanvas x:Name="CursorTimeMarkLayer" />
            <CM:DrawingCanvas x:Name="PaintingTimeLayer" />
            <CM:DrawingCanvas x:Name="HookTimeLayer" />
            <CM:DrawingCanvas x:Name="PrototypeTimeLayer" />
        </Grid>
        <Grid
            x:Name="IndicatorsGrid"
            Grid.Row="2"
            Grid.ColumnSpan="3"
            VerticalAlignment="Stretch">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="4" />
                <ColumnDefinition x:Name="PriceLineCD2" Width="70" />
            </Grid.ColumnDefinitions>
        </Grid>
        <GridSplitter
            Grid.Row="1"
            Grid.ColumnSpan="3"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Center"
            BorderBrush="Gray"
            BorderThickness="2"
            ShowsPreview="False" />
        <Border
            Grid.Row="3"
            Grid.ColumnSpan="3"
            BorderBrush="Gray"
            BorderThickness="2" />
        <Border
            Grid.RowSpan="6"
            Grid.Column="1"
            BorderBrush="Gray"
            BorderThickness="2" />

        <Grid Grid.Row="4" Grid.Column="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Button
                Grid.Column="0"
                Background="{x:Null}"
                BorderBrush="{x:Null}"
                Click="ShowBaseSettings"
                Foreground="{x:Null}">
                <Button.Content>
                    <res:Gear Foreground="{Binding FontBrush}" />
                </Button.Content>
            </Button>
            <Button
                Grid.Column="1"
                Background="{x:Null}"
                BorderBrush="{x:Null}"
                Foreground="{x:Null}">
                <Button.Content>
                    <res:Gear Foreground="{Binding FontBrush}" />
                </Button.Content>
            </Button>
        </Grid>
        <Grid Grid.RowSpan="4" ClipToBounds="True">
            <CM:DrawingCanvas x:Name="CursorLinesLayer" />
        </Grid>
    </Grid>
</UserControl>
